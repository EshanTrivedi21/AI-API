<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenAI Q&A</title>
  </head>
  <body>
    <div>
      <label for="question">Q:</label>
      <input type="text" id="question" />
      <button id="submit">Submit</button>
    </div>
    <br />
    <div>
      <label>A:</label>
      <span id="answer"></span>
    </div>
    <br />
    <div>
      <button id="continue" style="display: none">Continue</button>
    </div>

    <script>
      let prevQuestion = "";
      const submitButton = document.getElementById("submit");
      const continueButton = document.getElementById("continue");
      const questionInput = document.getElementById("question");
      const answerSpan = document.getElementById("answer");

      submitButton.addEventListener("click", () => {
        const question = questionInput.value.trim();
        if (question === prevQuestion) {
          alert(
            "You already asked this question, please ask a different question."
          );
          questionInput.value = "";
          return;
        }
        prevQuestion = question;

        const xhr = new XMLHttpRequest();
        xhr.open(
          "POST",
          "https://api.openai.com/v1/engines/davinci/completions"
        );
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader(
          "Authorization",
          "Bearer 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"
        );

        xhr.onreadystatechange = () => {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            let answer = response.choices[0].text.trim();
            let maxScore = response.choices[0].score;
            for (let i = 1; i < response.choices.length; i++) {
              if (response.choices[i].prompt === `Q: ${question}`) {
                if (response.choices[i].score > maxScore) {
                  answer = response.choices[i].text.trim();
                  maxScore = response.choices[i].score;
                }
              }
            }
            answerSpan.innerHTML = answer;
            continueButton.style.display = "block";
          }
        };

        xhr.send(
          JSON.stringify({
            prompt: `Q: ${question}`,
            temperature: 0.5,
            max_tokens: 150,
            top_p: 1,
            frequency_penalty: 0,
            presence_penalty: 0,
          })
        );
      });

      continueButton.addEventListener("click", () => {
        questionInput.value = "";
        answerSpan.innerHTML = "";
        continueButton.style.display = "none";
      });
    </script>
  </body>
</html>
